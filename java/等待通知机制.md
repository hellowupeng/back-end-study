# 等待/通知机制

等待/通知机制，是指一个线程A调用了对象O的wait()方法进入等待状态，而另一个线程B调用了对象O的notify()或者notifyAll()方法，线程A收到通知后从对象O的wait()方法返回，进而执行后续操作。

其中，调用wait()、notify()以及notifyAll()时需要注意：

1）使用wait()、notify()和notifyAll()时需要先对调用对象加锁。

2）调用wait()方法后，线程状态由RUNNING变为WAITING，并将当前线程放置到对象的等待队列。

3）notify()或notifyAll()方法调用后，等待线程依旧不会从wait()返回，需要调用notify()或notifyAll()的线程释放锁之后，等待线程才有机会从wait()返回。

4）notify()方法将等待队列中的一个等待线程从等待队列中移到同步队列中，而notifyAll()方法则是将等待队列中所有的线程全部移到同步队列，被移动的线程状态由WAITING变为BLOCKED。

5）从wait()方法返回的前提是获得了调用对象的锁。

（线程A首先获取了对象的锁，然后调用对象的wait()方法，从而放弃了锁并进入了对象的等待队列（WaitQueue）中，进入等待状态。由于线程A释放了对象的锁，线程B随后获取了对象的锁，并调用对象的notify()方法，将线程A从等待队列移到同步队列中，此时线程A的状态变为阻塞状态（BLOCKED）。线程B释放了锁之后，线程A再次获取到锁并从wait()方法返回继续执行。）

##### 参考资料

1. 《Java并发编程的艺术》4.3.2 等待/通知机制